name: Quick Test - Environment Setup Only

on:
  workflow_dispatch:
    inputs:
      webrtc_branch:
        description: 'WebRTC branch to test'
        required: false
        default: 'branch-heads/7151'

jobs:
  quick-test:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Test Environment Setup (Local Action)
        uses: ./
        with:
          webrtc_branch: ${{ github.event.inputs.webrtc_branch || 'branch-heads/7151' }}
          target_arch: 'arm64-v8a'
          build_config: 'release'
        # We can modify action.yml to add a 'test_mode' input that stops after environment setup
      
      - name: Verify milestone detection
        run: |
          echo "Testing milestone detection logic..."
          BRANCH_NUMBER=$(echo "${{ github.event.inputs.webrtc_branch || 'branch-heads/7151' }}" | sed 's/.*branch-heads\///')
          echo "Branch number: $BRANCH_NUMBER"
          
          if [ "$BRANCH_NUMBER" -ge 7151 ]; then
            MILESTONE="M137"
          elif [ "$BRANCH_NUMBER" -ge 7103 ]; then
            MILESTONE="M136" 
          elif [ "$BRANCH_NUMBER" -ge 7000 ]; then
            MILESTONE="M135"
          else
            MILESTONE="M134"
          fi
          
          echo "Detected milestone: $MILESTONE"
          echo "âœ… Milestone detection working correctly"